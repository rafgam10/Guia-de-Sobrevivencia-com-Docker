
# Docker Compose: o que é e por que usar

Docker Compose é a ferramenta que permite **definir, configurar e rodar aplicações com múltiplos containers** usando um único arquivo declarativo (`docker-compose.yml`).

Se Docker resolve o problema de **um container**, Docker Compose resolve o problema de **uma aplicação inteira**.

---

## 1) O problema sem Docker Compose

Imagine uma aplicação com:
- backend (Flask)
- frontend (React)
- banco de dados (PostgreSQL)
- cache (Redis)

Sem Docker Compose, você teria que rodar algo assim:

```bash
docker run ...
docker run ...
docker run ...
docker run ...
````

Problemas desse modelo:

- muitos comandos manuais
- fácil errar flags (`-p`, `-e`, `-v`)
- difícil reproduzir em outro ambiente
- onboarding lento
- baixa padronização 

---

## 2) O que é Docker Compose

Docker Compose é uma ferramenta que:

- descreve toda a aplicação em **um único arquivo**
- define serviços, redes, volumes e variáveis
- permite subir tudo com **um comando**

Arquivo principal:

```txt
docker-compose.yml
```

Comando principal:

```bash
docker compose up
```

---

## 3) Conceito central: serviços

No Docker Compose, cada container é definido como um **service**.

Exemplo:

- `api` → backend Flask
- `frontend` → React
- `db` → PostgreSQL

Cada serviço:

- usa uma imagem ou build
- pode ter portas, volumes, redes e variáveis
- pode depender de outros serviços

---

## 4) Exemplo mínimo de Docker Compose

```yaml
services:
  api:
    image: flask_app
    ports:
      - "5000:5000"
```

Isso substitui:

```bash
docker run -p 5000:5000 flask_app
```

A vantagem é que a configuração fica **documentada e versionada**.

---

## 5) Exemplo real: Flask + PostgreSQL

```yaml
services:
  api:
    build: .
    ports:
      - "5000:5000"
    environment:
      DATABASE_URL: postgresql://user:pass@db:5432/app
    depends_on:
      - db

  db:
    image: postgres:16
    volumes:
      - pgdata:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: app
      POSTGRES_USER: user
      POSTGRES_PASSWORD: pass

volumes:
  pgdata:
```

Com um comando:

```bash
docker compose up
```

Você sobe:

- backend
- banco
- volume
- rede interna

---

## 6) Por que usar Docker Compose

### 6.1 Padronização

- todo o time usa a mesma configuração
- menos bugs de ambiente
- fácil de versionar no Git

---

### 6.2 Simplicidade

Um comando substitui dezenas:

```bash
docker compose up
docker compose down
```

---

### 6.3 Comunicação automática entre containers

- serviços se comunicam pelo nome
- DNS interno automático
- sem IPs fixos

Exemplo:

```txt
db:5432
```

---

### 6.4 Gerenciamento de dependências

```yaml
depends_on:
  - db
```

Garante ordem de inicialização (parcial).

---

### 6.5 Ideal para desenvolvimento

- hot reload com volumes
- logs centralizados
- setup rápido

---

### 6.6 Próximo do ambiente de produção

- mesma arquitetura
- mesmos containers
- menos surpresas no deploy

---

## 7) Docker Compose não é só para desenvolvimento

Apesar de muito usado em desenvolvimento, Compose também é usado em:

- staging
- pequenos deploys
- servidores únicos
- CI/CD

Limitação:

- não escala automaticamente como Kubernetes
- não é um orquestrador completo

---

## 8) Docker Compose vs docker run

|docker run|Docker Compose|
|---|---|
|Um container|Vários containers|
|Configuração imperativa|Configuração declarativa|
|Difícil de repetir|Fácil de reproduzir|
|Pouco organizado|Estrutura clara|
|Não versionado|Versionado no Git|

---

## 9) Estrutura comum de projeto

```
project/
├── backend/
│   ├── Dockerfile
│   └── app.py
├── frontend/
│   ├── Dockerfile
│   └── src/
├── docker-compose.yml
├── .env
```

Tudo centralizado.

---

## 10) Comandos básicos do Docker Compose

```bash
docker compose up
docker compose up -d
docker compose down
docker compose logs
docker compose ps
docker compose build
```

---

## 11) Erros comuns ao usar Docker Compose

- Usar `localhost` entre serviços
- Expor banco de dados sem necessidade
- Misturar bind mount de código em produção
- Não usar volumes para dados
- Colocar segredos no `docker-compose.yml`

---

## 12) Boas práticas iniciais

- Um serviço por container
- Usar `.env` para variáveis
- Não expor serviços internos
- Versionar `docker-compose.yml`
- Usar nomes claros de serviços

---

## 13) Quando NÃO usar Docker Compose

- orquestração em grande escala
- auto-scaling avançado
- múltiplos nós

Nesses casos:

- Kubernetes
- ECS
- Nomad

---

## 14) Resumo

- Docker Compose define aplicações multi-container
- Usa um arquivo YAML declarativo
- Simplifica setup, comunicação e execução
- É essencial para projetos reais
- Ponte natural entre Docker e Kubernetes

---

## 15) Próximos tópicos recomendados

- Docker Compose na prática
- Volumes e redes no Compose
- Healthchecks e dependências
- Override de ambientes (dev/prod)
- Deploy com Docker Compose


# Trabalhando com volumes no Docker (Parte 1)

Volumes são um dos conceitos mais importantes do Docker. Eles resolvem um problema fundamental: **containers são descartáveis, dados não**.

Este material foca nos **conceitos básicos**, tipos de volumes e uso no dia a dia.

---

## 1) O problema: containers são efêmeros

Por padrão:
- containers podem ser removidos a qualquer momento
- arquivos criados dentro do container são perdidos ao removê-lo

Exemplo:
```bash
docker run ubuntu touch arquivo.txt
````

Se o container for removido:

```bash
docker rm <container_id>
```

O arquivo desaparece.

Isso é aceitável para código, mas **não para dados**:

- banco de dados
- uploads
- logs
- arquivos gerados pela aplicação

---

## 2) O que são volumes no Docker

Um **volume** é um mecanismo do Docker para **persistir dados fora do ciclo de vida do container**.

Características:

- dados sobrevivem à remoção do container
- podem ser compartilhados entre containers
- gerenciados pelo Docker
- independentes da imagem

Em resumo:

- container morre
- volume continua

---

## 3) Tipos de persistência no Docker

Existem três formas principais:

1. Volumes (Docker volumes)
2. Bind mounts
3. tmpfs (memória)

Nesta parte, focaremos em **volumes e bind mounts**.

---

## 4) Volumes (Docker volumes)

Volumes são criados e gerenciados pelo Docker.

### Criando um volume

```bash
docker volume create dados_app
```

### Listando volumes

```bash
docker volume ls
```

### Inspecionando um volume

```bash
docker volume inspect dados_app
```

---

### Usando um volume em um container

```bash
docker run -v dados_app:/app/data ubuntu
```

Formato:

```
nome_do_volume:caminho_no_container
```

Tudo que for gravado em `/app/data` será persistido no volume.

---

### Exemplo prático

```bash
docker run -it -v dados_app:/dados ubuntu bash
```

Dentro do container:

```bash
echo "persistente" > /dados/arquivo.txt
exit
```

Rodando outro container:

```bash
docker run -it -v dados_app:/dados ubuntu bash
cat /dados/arquivo.txt
```

O arquivo ainda existe.

---

## 5) Bind mounts

Bind mounts conectam **um diretório do host diretamente ao container**.

Exemplo:

```bash
docker run -v $(pwd):/app ubuntu
```

Formato:

```
caminho_host:caminho_container
```

---

### Quando usar bind mount

- desenvolvimento
- hot reload
- edição de código em tempo real

Exemplo com Flask:

```bash
docker run -p 5000:5000 -v $(pwd):/app flask_app
```

O código muda no host e reflete no container.

---

## 6) Diferença entre volume e bind mount

|Característica|Volume|Bind mount|
|---|---|---|
|Gerenciado pelo Docker|Sim|Não|
|Portável|Sim|Não|
|Ideal para produção|Sim|Não|
|Ideal para desenvolvimento|Às vezes|Sim|
|Depende do host|Pouco|Muito|

Regra prática:

- produção → volumes
- desenvolvimento → bind mounts

---

## 7) Onde os volumes ficam armazenados

O Docker armazena volumes internamente, por exemplo:

- Linux: `/var/lib/docker/volumes/`
- Docker Desktop: gerenciado internamente

Você normalmente **não precisa acessar isso diretamente**.

---

## 8) Volumes anônimos

Se você fizer:

```bash
docker run -v /dados ubuntu
```

Docker cria um volume **anônimo**:

- sem nome
- difícil de gerenciar
- fácil de esquecer

Recomendação:

- prefira volumes nomeados

---

## 9) Removendo volumes

### Remover volume específico

```bash
docker volume rm dados_app
```

### Remover volumes não usados

```bash
docker volume prune
```

Cuidado:

- dados serão apagados permanentemente

---

## 10) Exemplo real: banco de dados

Sem volume:

- remove o container
- perde os dados

Com volume:

```bash
docker run -d \
  --name postgres \
  -v pgdata:/var/lib/postgresql/data \
  postgres:16
```

O banco persiste mesmo se o container for recriado.

---

## 11) Boas práticas iniciais

- Use volumes nomeados para dados importantes
- Use bind mounts apenas em desenvolvimento
- Não confie em dados dentro do container
- Dê nomes claros aos volumes
- Documente volumes no projeto

---

## 12) Erros comuns

- Achar que dados no container são persistentes
- Usar bind mount em produção sem cuidado
- Criar volumes anônimos sem perceber
- Remover volumes achando que só remove container

---

## 13) Resumo

- containers são descartáveis
- volumes guardam dados
- volume ≠ bind mount
- volumes são ideais para produção
- bind mounts são ideais para desenvolvimento


# Exemplo simples: Flask com Docker (passo a passo)

Este é um exemplo bem simples para você aprender Docker com Flask sem complicar.  
A ideia é criar uma API mínima, colocar em um container e rodar localmente.

---

## 1) Objetivo

Ao final, você vai conseguir:
- criar uma API Flask mínima
- criar um `Dockerfile` simples
- buildar uma imagem
- rodar o container com `-p` para acessar pelo navegador

---

## 2) Estrutura do projeto

Crie uma pasta e estes arquivos:

```

flask-docker-simples/  
├── app.py  
├── requirements.txt  
└── Dockerfile

````

---

## 3) Código Flask (app.py)

Crie o arquivo `app.py`:

```python
from flask import Flask

app = Flask(__name__)

@app.get("/")
def home():
    return {"message": "Flask rodando no Docker"}

@app.get("/health")
def health():
    return {"status": "ok"}
````

Esse app tem:

- `GET /` retorna uma mensagem
    
- `GET /health` retorna status (útil para testes e healthcheck)
    

---

## 4) Dependências (requirements.txt)

Crie `requirements.txt`:

```txt
flask==3.0.0
```

Observação:

- você pode ajustar a versão se quiser
- fixar versão ajuda a reproduzir o ambiente

---

## 5) Dockerfile (o mais simples possível)

Crie `Dockerfile`:

```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY app.py .

CMD ["python", "-m", "flask", "--app", "app", "run", "--host=0.0.0.0", "--port=5000"]
```

O que cada linha faz:

- `FROM python:3.11-slim`: imagem base com Python
- `WORKDIR /app`: pasta de trabalho no container
- `COPY requirements.txt .`: copia dependências
- `RUN pip install ...`: instala dependências
- `COPY app.py .`: copia o código
- `CMD ...`: inicia o Flask escutando em `0.0.0.0` para aceitar conexões fora do container

---

## 6) Build da imagem

Dentro da pasta do projeto, rode:

```bash
docker build -t flask-simples .
```

O que acontece:

- o Docker lê o Dockerfile
- cria as camadas da imagem
- gera uma imagem chamada `flask-simples`

Para confirmar:

```bash
docker images
```

---

## 7) Rodando o container

Agora rode:

```bash
docker run -p 5000:5000 flask-simples
```

O que isso faz:

- cria um container a partir da imagem `flask-simples`
- publica a porta 5000 do container para a porta 5000 do host

---

## 8) Testando no navegador ou curl

No navegador:

- `http://localhost:5000/`
- `http://localhost:5000/health`

Ou via `curl`:

```bash
curl http://localhost:5000/
curl http://localhost:5000/health
```

Saída esperada:

```json
{"message":"Flask rodando no Docker"}
```

```json
{"status":"ok"}
```

---

## 9) Parando o container

No terminal onde ele está rodando:

- pressione `Ctrl + C`

Se você rodou em background (não é o caso aqui), use:

```bash
docker ps
docker stop <container_id>
```

---

## 10) Erros comuns e como corrigir

### 10.1 A aplicação roda mas não abre no navegador

Causa comum:

- Flask rodando em `127.0.0.1`

Solução:

- garantir `--host=0.0.0.0` no CMD

---

### 10.2 Porta já está em uso

Se a porta 5000 já estiver ocupada:

```bash
docker run -p 8080:5000 flask-simples
```

Acesse:

- `http://localhost:8080`

---

## 11) Extensão opcional: modo desenvolvimento com bind mount

Se quiser mudar o código sem rebuildar:

```bash
docker run -p 5000:5000 -v $(pwd):/app flask-simples
```

Observação:

- como o CMD roda `flask run`, ele não reinicia automaticamente sem `--reload` (dependendo da versão/config)
- para um fluxo melhor, depois você pode evoluir para Docker Compose

---

## 12) Resumo do que você aprendeu

- Um Dockerfile define como criar a imagem
- `docker build` cria a imagem
- `docker run -p` cria e executa o container expondo portas
- Flask precisa escutar em `0.0.0.0` dentro do container

---

## 13) Próximo passo recomendado

Depois desse exemplo, o próximo nível natural é:

- Flask + Docker Compose (com banco)
- usar Gunicorn em produção
- variáveis de ambiente (`.env`)
- healthcheck e logs



# Criando um banco MySQL com Docker Compose (guia completo e simples)

Este guia mostra **como criar e usar um banco MySQL com Docker Compose**, de forma **didática**, **passo a passo** e alinhada com **boas práticas reais de mercado**.

Você vai aprender:
- subir um MySQL em container
- configurar usuário, senha e banco
- persistir dados corretamente
- entender variáveis de ambiente do MySQL
- conectar aplicações depois
- evitar erros comuns

---

## 1) Por que usar MySQL com Docker Compose

Usar MySQL via Docker Compose permite:
- não instalar MySQL localmente
- ter ambiente reproduzível
- subir o banco com um comando
- isolar o banco do sistema host
- padronizar dev, staging e prod

É um padrão muito comum em projetos PHP, Node e Python.

---

## 2) Arquitetura básica

Neste guia teremos apenas o banco:

```

Aplicação (futura) ───▶ MySQL (container)

```

Depois ele pode ser integrado a qualquer backend.

---

## 3) Estrutura mínima do projeto

Crie a seguinte estrutura:

```

mysql-compose/
├── docker-compose.yml
├── .env
└── README.md

````

---

## 4) Variáveis de ambiente do MySQL (.env)

Crie o arquivo `.env`:

```env
MYSQL_ROOT_PASSWORD=root
MYSQL_DATABASE=app
MYSQL_USER=appuser
MYSQL_PASSWORD=apppass
````

O que cada variável faz:

* `MYSQL_ROOT_PASSWORD`
  Senha do usuário root (obrigatória)

* `MYSQL_DATABASE`
  Banco criado automaticamente no primeiro start

* `MYSQL_USER`
  Usuário adicional criado automaticamente

* `MYSQL_PASSWORD`
  Senha do usuário adicional

Boas práticas:

* nunca usar senhas fracas em produção
* nunca commitar `.env`
* usar `.env.prod` em produção

---

## 5) Docker Compose do MySQL

Crie o arquivo `docker-compose.yml`:

```yaml
services:
  db:
    image: mysql:8.3
    container_name: mysql-db
    restart: unless-stopped
    env_file:
      - .env
    volumes:
      - mysqldata:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 10s
      timeout: 5s
      retries: 5

volumes:
  mysqldata:
```

---

## 6) Entendendo cada parte do Compose

### `image: mysql:8.3`

* imagem oficial do MySQL
* versão fixa (boa prática)
* evita mudanças inesperadas

---

### `container_name`

* facilita debug local
* não recomendado quando há escala

---

### `restart: unless-stopped`

* banco reinicia automaticamente
* volta após reboot do host
* não reinicia se parar manualmente

---

### `env_file`

* carrega variáveis do `.env`
* mantém segredos fora do YAML

---

### `volumes`

```yaml
- mysqldata:/var/lib/mysql
```

* garante persistência dos dados
* sem volume, os dados seriam perdidos

---

### `healthcheck`

* verifica se o MySQL está pronto
* evita conexões prematuras
* essencial para serviços dependentes

---

## 7) Subindo o banco MySQL

Execute:

```bash
docker compose up -d
```

Verifique status:

```bash
docker ps
```

Você deve ver:

```
healthy
```

---

## 8) Acessando o MySQL pelo terminal

### Entrar no container

```bash
docker exec -it mysql-db mysql -u root -p
```

Digite a senha definida em `MYSQL_ROOT_PASSWORD`.

---

### Selecionar o banco criado

```sql
USE app;
SHOW TABLES;
```

---

### Teste simples

```sql
CREATE TABLE teste (
  id INT AUTO_INCREMENT PRIMARY KEY,
  nome VARCHAR(100)
);

INSERT INTO teste (nome) VALUES ('Docker funciona');
SELECT * FROM teste;
```

---

## 9) Testando persistência dos dados

1. Crie dados no banco
2. Pare os containers:

```bash
docker compose down
```

3. Suba novamente:

```bash
docker compose up -d
```

4. Entre no banco e consulte os dados

Resultado esperado:

* dados continuam existindo

Isso confirma que o volume está correto.

---

## 10) Expondo a porta do MySQL (opcional)

### Não expor (recomendado)

```yaml
db:
  image: mysql:8.3
```

* mais seguro
* ideal quando apenas containers acessam o banco

---

### Expor a porta (útil em desenvolvimento)

```yaml
ports:
  - "3306:3306"
```

Permite:

* usar DBeaver
* usar MySQL Workbench
* debug local

Nunca exponha MySQL em produção sem firewall e controle.

---

## 11) String de conexão MySQL

Formato geral:

```txt
mysql://usuario:senha@host:porta/banco
```

Exemplo no Docker Compose:

```txt
mysql://appuser:apppass@db:3306/app
```

Onde:

* `db` é o nome do serviço
* nunca use `localhost` entre containers

---

## 12) Conectando uma aplicação depois

### Exemplo em Python (mysql-connector)

```python
import mysql.connector

conn = mysql.connector.connect(
    host="db",
    user="appuser",
    password="apppass",
    database="app"
)
```

---

### Exemplo em PHP (PDO)

```php
$pdo = new PDO(
    "mysql:host=db;dbname=app",
    "appuser",
    "apppass"
);
```

---

## 13) Inicializando o banco com SQL (opcional)

Você pode criar scripts SQL automáticos:

```yaml
volumes:
  - ./init.sql:/docker-entrypoint-initdb.d/init.sql
```

O MySQL executa esses scripts **apenas no primeiro start**.

---

## 14) Erros comuns

* esquecer volume (dados perdidos)
* usar `localhost` no host
* não definir `MYSQL_ROOT_PASSWORD`
* usar `latest`
* expor banco em produção
* não esperar o banco ficar pronto

---

## 15) Boas práticas

* sempre usar volume
* fixar versão da imagem
* usar `.env`
* healthcheck ativo
* não expor banco sem motivo
* backups periódicos

---

## 16) Checklist rápido

* [ ] Imagem oficial MySQL
* [ ] Volume configurado
* [ ] `.env` com variáveis
* [ ] Healthcheck ativo
* [ ] Restart policy definida
* [ ] Porta exposta apenas se necessário

---

## 17) Conclusão

Criar um MySQL com Docker Compose:

* é simples
* é profissional
* é reproduzível
* elimina problemas de ambiente

Esse setup é base para:

* APIs
* sistemas PHP
* sistemas Python
* projetos full stack
* microsserviços

---

## 18) Próximos passos possíveis

* MySQL + Flask
* MySQL + PHP (Laravel)
* MySQL + Node.js
* Migrations (Flyway / Alembic)
* Backup e restore
* MySQL em produção (cloud)

